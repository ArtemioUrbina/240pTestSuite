name: BUILD-N64-ROM

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Build using libDragon Container
      run: |
        npm i -g libdragon@latest
        libdragon init
        # Copy the adjusted source into the .libdragon folder?
        ls
        cp -f ${{ github.workspace }}/240psuite/N64/libdragonchanges/display.c ${{ github.workspace }}/libdragon/src
        cp -f ${{ github.workspace }}/240psuite/N64/libdragonchanges/graphics.c ${{ github.workspace }}/libdragon/src
        cp -f ${{ github.workspace }}/240psuite/N64/libdragonchanges/display.h ${{ github.workspace }}/libdragon/include
        cp -f ${{ github.workspace }}/240psuite/N64/libdragonchanges/font.h ${{ github.workspace }}/libdragon/include
        # Rebuild libdragon for changed source
        libdragon make install
        # libdragon make tools-install
        cd ${{ github.workspace }}/240psuite/N64/
        libdragon make
